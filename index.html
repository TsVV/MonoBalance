<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –±–∞–ª–∞–Ω—Å—É Monobank 1.0.0</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
    }

    .settings-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      transition: background 0.2s;
    }

    .settings-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 5px;
    }

    .header p {
      opacity: 0.9;
      font-size: 14px;
    }

    .balance-section {
      padding: 30px;
      background: #f8f9fa;
    }

    .balance-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .balance-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .balance-card label {
      display: block;
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 8px;
      text-transform: uppercase;
      font-weight: 600;
    }

    .balance-card .amount {
      font-size: 24px;
      font-weight: bold;
      color: #2d3748;
    }

    .balance-card.uah .amount {
      color: #667eea;
    }

    .balance-card.eur .amount {
      color: #48bb78;
    }

    .balance-card.rate .amount {
      color: #f6ad55;
      font-size: 20px;
    }

    .update-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .update-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .update-btn:active {
      transform: translateY(0);
    }

    .history-section {
      padding: 30px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .history-header h2 {
      font-size: 20px;
      color: #2d3748;
    }

    .clear-btn {
      padding: 8px 15px;
      background: #e53e3e;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .clear-btn:hover {
      background: #c53030;
    }

    .history-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .history-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid #667eea;
    }

    .history-item .date {
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 8px;
    }

    .history-item .values {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .history-item .value {
      font-size: 14px;
    }

    .history-item .value strong {
      display: block;
      font-size: 16px;
      margin-top: 3px;
    }

    .empty-history {
      text-align: center;
      padding: 40px;
      color: #6c757d;
    }

    .empty-history svg {
      width: 60px;
      height: 60px;
      margin-bottom: 15px;
      opacity: 0.3;
    }

    /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 15px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 30px;
      border-radius: 15px 15px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 22px;
    }

    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .modal-body {
      padding: 30px;
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #2d3748;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group .hint {
      font-size: 12px;
      color: #6c757d;
      margin-top: 5px;
    }

    .card-option {
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-option:hover {
      border-color: #667eea;
      background: #f8f9fa;
    }

    .card-option.selected {
      border-color: #667eea;
      background: #eef2ff;
    }

    .card-option .card-info {
      flex: 1;
    }

    .card-option .card-type {
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 4px;
    }

    .card-option .card-details {
      font-size: 12px;
      color: #6c757d;
    }

    .card-option .card-balance {
      font-weight: 600;
      color: #667eea;
      font-size: 16px;
    }

    .save-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .save-btn:hover {
      transform: translateY(-2px);
    }

    .save-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .loading-cards {
      text-align: center;
      padding: 40px;
      color: #6c757d;
    }

    /* 1) –ì–∞—Å–∏–º–æ –ø—Ä–æ–∫—Ä—É—Ç–∫—É —É –≤—Å—å–æ–≥–æ –≤—ñ–∫–Ω–∞ */
    html, body { height: 100%; overflow: hidden; }

    /* 2) –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–æ–∑—Ç—è–≥—É—î–º–æ –Ω–∞ –≤–µ—Å—å –µ–∫—Ä–∞–Ω —ñ —Ä–æ–±–∏–º–æ –∫–æ–ª–æ–Ω–∫–∏ */
    .container { height: 100%; display: flex; flex-direction: column; }

    /* 3) –°–µ–∫—Ü—ñ—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑–∞–π–º–∞—î –≤–µ—Å—å –∑–∞–ª–∏—à–æ–∫, –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç–µ–∂ –∫–æ–ª–æ–Ω–∫–∞ */
    .history-section { flex: 1; display: flex; flex-direction: column; min-height: 0; }

    /* 4) –°–∞–º–∞ —ñ—Å—Ç–æ—Ä—ñ—è ‚Äî —î–¥–∏–Ω–∞ –æ–±–ª–∞—Å—Ç—å —ñ–∑ –ø—Ä–æ–∫—Ä—É—Ç–∫–æ—é */
    .history-list {
      flex: 1;
      overflow-y: auto;
      max-height: none; /* –ø—Ä–∏–±—Ä–∞—Ç–∏ —Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ 300px */
    }

  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <button class="settings-btn" id="settingsBtn" title="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è">‚öôÔ∏è</button>
      <h1>üí∞ –ë–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç–∫–∏ Monobank</h1>
      <p>–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ä–∞—Ö—É–Ω–∫—É –∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—î—é</p>
    </div>

    <div class="balance-section">
      <div class="balance-grid">
        <div class="balance-card uah">
          <label>–ì—Ä–∏–≤–Ω—è (UAH)</label>
          <div class="amount" id="balanceUAH">0.00 ‚Ç¥</div>
        </div>
        <div class="balance-card rate">
          <label>–ö—É—Ä—Å EUR</label>
          <div class="amount" id="rateEUR">0.00</div>
        </div>
        <div class="balance-card eur">
          <label>–Ñ–≤—Ä–æ (EUR)</label>
          <div class="amount" id="balanceEUR">0.00 ‚Ç¨</div>
        </div>
      </div>
      <button class="update-btn" id="updateBtn">üîÑ –û–Ω–æ–≤–∏—Ç–∏ –±–∞–ª–∞–Ω—Å</button>
    </div>

    <div class="history-section">
      <div class="history-header">
        <h2>üìä –Ü—Å—Ç–æ—Ä—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ–π</h2>
        <button class="clear-btn" id="clearBtn">–û—á–∏—Å—Ç–∏—Ç–∏</button>
      </div>
      <div class="history-list" id="historyList">
        <div class="empty-history">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
          </svg>
          <p>–Ü—Å—Ç–æ—Ä—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ–π –ø–æ—Ä–æ–∂–Ω—è</p>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
        <button class="modal-close" id="closeSettings">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>üîë –¢–æ–∫–µ–Ω Monobank API</label>
          <input type="password" id="tokenInput" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω">
          <div class="hint">–û—Ç—Ä–∏–º–∞—Ç–∏: –î–æ–¥–∞—Ç–æ–∫ Monobank ‚Üí –ú–µ–Ω—é ‚Üí –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Üí API –¥–ª—è –æ—Å–æ–±–∏—Å—Ç–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è</div>
          <button class="update-btn" id="clearTokenBtn" style="margin-left:10px;">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ —Ç–æ–∫–µ–Ω</button>
        </div>

        <div class="form-group">
          <label>üí≥ –û–±–µ—Ä—ñ—Ç—å –∫–∞—Ä—Ç–∫—É</label>
          <div id="cardsList">
            <div class="loading-cards">
              <p>–í–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏"</p>
            </div>
          </div>
          <button class="update-btn" id="loadCardsBtn" style="margin-top: 10px;">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏</button>
        </div>

        <div class="form-group">
          <label>üí± –í–∞–ª—é—Ç–∞ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó</label>
          <select id="currencySelect">
            <option value="978">EUR - –Ñ–≤—Ä–æ</option>
            <option value="840">USD - –î–æ–ª–∞—Ä –°–®–ê</option>
            <option value="826">GBP - –§—É–Ω—Ç —Å—Ç–µ—Ä–ª—ñ–Ω–≥—ñ–≤</option>
            <option value="985">PLN - –ü–æ–ª—å—Å—å–∫–∏–π –∑–ª–æ—Ç–∏–π</option>
          </select>
        </div>

        <button class="save-btn" id="saveSettingsBtn">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
      </div>
    </div>
  </div>

  <script>
    // –¢–∏–º—á–∞—Å–æ–≤–æ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–æ–∫–µ–Ω –≤ –ø–∞–º'—è—Ç—ñ –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ—ó —Å–µ—Å—ñ—ó
    // let currentToken = null;
    let selectedCardId = null;
    let availableCards = [];
    let history = [];
    let isLoading = false;
    let cooldownTimer = null;
    let cooldownSeconds = 0;

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
    function loadSettings() {
      const settings = localStorage.getItem('appSettings');
      if (settings) {
        const parsed = JSON.parse(settings);
        // currentToken = parsed.token;
        selectedCardId = parsed.cardId;
        document.getElementById('currencySelect').value = parsed.currency || '978';
      }
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑ localStorage
    function loadHistory() {
      const saved = localStorage.getItem('bankHistory');
      if (saved) {
        history = JSON.parse(saved);
        renderHistory();
      }
      
      // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –±—É–≤ –Ω–µ–¥–∞–≤–Ω–æ –∑–∞–ø–∏—Ç
      const lastUpdate = localStorage.getItem('lastUpdateTime');
      if (lastUpdate) {
        const timePassed = Date.now() - parseInt(lastUpdate);
        const remainingTime = 90000 - timePassed; // 90 —Å–µ–∫—É–Ω–¥ = 90000 –º—Å
        
        if (remainingTime > 0) {
          startCooldown(Math.ceil(remainingTime / 1000));
        }
      }
    }

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
    function saveHistory() {
      localStorage.setItem('bankHistory', JSON.stringify(history));
    }

    // –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–∞—Ç–∏
    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      return `${year}-${month}-${day} ${hours}:${minutes}`;
    }

    // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
    function startCooldown(seconds) {
      cooldownSeconds = seconds;
      const btn = document.getElementById('updateBtn');
      btn.disabled = true;
      
      updateCooldownDisplay();
      
      cooldownTimer = setInterval(() => {
        cooldownSeconds--;
        
        if (cooldownSeconds <= 0) {
          clearInterval(cooldownTimer);
          cooldownTimer = null;
          btn.disabled = false;
          btn.textContent = 'üîÑ –û–Ω–æ–≤–∏—Ç–∏ –±–∞–ª–∞–Ω—Å';
        } else {
          updateCooldownDisplay();
        }
      }, 1000);
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä–∞
    function updateCooldownDisplay() {
      const btn = document.getElementById('updateBtn');
      const minutes = Math.floor(cooldownSeconds / 60);
      const seconds = cooldownSeconds % 60;
      btn.textContent = `‚è≥ –û—á—ñ–∫—É–≤–∞–Ω–Ω—è: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    // –ü–æ–≤–µ—Ä—Ç–∞—î –∫—É—Ä—Å –ø–∞—Ä–∏ A/B (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, EUR/UAH). –ü–µ—Ä–µ–≤–∞–≥–∞ ‚Äî rateSell, –¥–∞–ª—ñ rateCross, –¥–∞–ª—ñ rateBuy.
    function getPairRate(rates, codeA, codeB) {
      const p = rates.find(r => r.currencyCodeA === codeA && r.currencyCodeB === codeB);
      if (!p) return null;
      return p.rateSell || p.rateCross || p.rateBuy || null;
    }

    // –°–∫—ñ–ª—å–∫–∏ UAH –∑–∞ 1 –æ–¥–∏–Ω–∏—Ü—é –≤–∞–ª—é—Ç–∏ src (src -> UAH)
    function rateToUAH(rates, src) {
      const UAH = 980;
      return getPairRate(rates, src, UAH);
    }

    // –°–∫—ñ–ª—å–∫–∏ UAH –∑–∞ 1 –æ–¥–∏–Ω–∏—Ü—é –≤–∞–ª—é—Ç–∏ tgt, –¥–ª—è UAH -> tgt –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥—ñ–ª–∏—Ç–∏ (UAH -> tgt)
    function rateUAHto(rates, tgt) {
      const UAH = 980;
      return getPairRate(rates, tgt, UAH); // –¥–∞—î "UAH –∑–∞ 1 tgt"
    }

    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è "–∑ –≤–∞–ª—é—Ç–∏ –∫–∞—Ä—Ç–∫–∏ ‚Üí –æ–±—Ä–∞–Ω–∞ –≤–∞–ª—é—Ç–∞" —á–µ—Ä–µ–∑ UAH —è–∫ ¬´–º—ñ—Å—Ç¬ª
    function convertViaUAH(rates, amountSrc, srcCode, tgtCode) {
      const UAH = 980;
      if (srcCode === tgtCode) return { amountTgt: amountSrc, effRate: 1 };

      // src -> UAH (–º–Ω–æ–∂–∏–º–æ –Ω–∞ –∫—É—Ä—Å src/UAH)
      const srcToUAH = srcCode === UAH ? 1 : rateToUAH(rates, srcCode);
      if (!srcToUAH) return { amountTgt: 0, effRate: null };

      const amountUAH = srcCode === UAH ? amountSrc : amountSrc * srcToUAH;

      // UAH -> tgt (–¥—ñ–ª–∏–º–æ –Ω–∞ –∫—É—Ä—Å tgt/UAH)
      const tgtPerUAH = tgtCode === UAH ? 1 : rateUAHto(rates, tgtCode);
      if (!tgtPerUAH) return { amountTgt: 0, effRate: null };

      const amountTgt = tgtCode === UAH ? amountUAH : amountUAH / tgtPerUAH;

      // ¬´–ï—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π¬ª –∫—É—Ä—Å src -> tgt (—Å–∫—ñ–ª—å–∫–∏ tgt –∑–∞ 1 src)
      const effRate =
        srcCode === UAH
          ? (1 / (tgtPerUAH || Infinity))
          : tgtCode === UAH
          ? (srcToUAH || 0)
          : (srcToUAH || 0) / (tgtPerUAH || Infinity);

      return { amountTgt, effRate };
    }
  
    
    /**
     * –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫—É—Ä—Å—É –≤–∞–ª—é—Ç
     */
    async function getClientInfo() {
      return window.api.getClientInfo();
    }
    async function getCurrencyRates() {
      return window.api.getCurrencyRates();
    }

    // async function getCurrencyRates() {
    //   try {
    //     const response = await fetch('https://api.monobank.ua/bank/currency', {
    //       method: 'GET'
    //     });

    //     if (!response.ok) {
    //       throw new Error(`Monobank API Error: ${response.status} ${response.statusText}`);
    //     }

    //     const data = await response.json();
    //     return data;
    //   } catch (error) {
    //     console.error('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç:', error);
    //     throw error;
    //   }
    // }

    // async function getClientInfo() {
    //   try {
    //     const response = await fetch('https://api.monobank.ua/personal/client-info', {
    //       method: 'GET',
    //       headers: {
    //         'X-Token': currentToken
    //       }
    //     });

    //     if (!response.ok) {
    //       throw new Error(`Monobank API Error: ${response.status} ${response.statusText}`);
    //     }

    //     const data = await response.json();
    //     return data;
    //   } catch (error) {
    //     console.error('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ Monobank:', error);
    //     throw error;
    //   }
    // }

    /**
     * –û—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–∞—Ö—É–Ω–∫—É —Ç–∞ –∫—É—Ä—Å—É EUR
     */
    async function getBalanceAndRate() {
      try {
        const clientInfo = await getClientInfo();
        const rates = await getCurrencyRates();

        if (!clientInfo.accounts || clientInfo.accounts.length === 0) {
          throw new Error('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∂–æ–¥–Ω–æ–≥–æ —Ä–∞—Ö—É–Ω–∫—É');
        }

        const account = clientInfo.accounts.find(acc => acc.id === selectedCardId);
        if (!account) throw new Error('–†–∞—Ö—É–Ω–æ–∫ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –í–∏–±–µ—Ä—ñ—Ç—å –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö.');

        const amountNative = account.balance / 100;            // –±–∞–ª–∞–Ω—Å —É –≤–∞–ª—é—Ç—ñ –∫–∞—Ä—Ç–∫–∏
        const srcCode = account.currencyCode;                  // –≤–∞–ª—é—Ç–∞ –∫–∞—Ä—Ç–∫–∏
        const tgtCode = parseInt(document.getElementById('currencySelect').value, 10); // –æ–±—Ä–∞–Ω–∞ –≤–∞–ª—é—Ç–∞
        const UAH = 980;

        const uahPerTgt = (tgtCode === UAH) ? 1 : rateUAHto(rates, tgtCode);

        const currencyNames = {980:'UAH',978:'EUR',840:'USD',826:'GBP',985:'PLN'};
        const typeNames = {
          black:'üñ§ –ß–æ—Ä–Ω–∞', white:'ü§ç –ë—ñ–ª–∞', platinum:'üíé Platinum',
          iron:'üî© Iron', fop:'üíº –§–û–ü', yellow:'üíõ –ñ–æ–≤—Ç–∞', eAid:'üá∫üá¶ —î–ü—ñ–¥—Ç—Ä–∏–º–∫–∞'
        };

        const maskedPan = account.maskedPan ? account.maskedPan[0] : '';
        const last4 = maskedPan ? maskedPan.slice(-4) : '';
        const cardLabel = `${typeNames[account.type] || account.type} ${last4 ? '****'+last4 : ''}`;
        const cardCurrencyTxt = currencyNames[srcCode] || String(srcCode);

        // –ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ UAH –∑–∞–≤–∂–¥–∏
        let balanceUAH;
        if (srcCode === UAH) {
          balanceUAH = amountNative;
        } else {
          const r = rateToUAH(rates, srcCode);
          balanceUAH = r ? amountNative * r : 0;
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è —É –≤–∏–±—Ä–∞–Ω—É –≤–∞–ª—é—Ç—É
        const { amountTgt, effRate } = convertViaUAH(rates, amountNative, srcCode, tgtCode);

        return {
          balanceUAH: balanceUAH,
          convRate: effRate || 0,           // –∫—É—Ä—Å "–∑ –≤–∞–ª—é—Ç–∏ –∫–∞—Ä—Ç–∫–∏ ‚Üí –æ–±—Ä–∞–Ω–∞ –≤–∞–ª—é—Ç–∞"
          balanceTgt: amountTgt || 0,       // —Å—É–º–∞ —É –≤–∏–±—Ä–∞–Ω—ñ–π –≤–∞–ª—é—Ç—ñ
          accountName: account.type,
          currency: srcCode,
          iban: account.iban,
          rateUAHperTgt: uahPerTgt || 0, // <-- –¥–æ–¥–∞–ª–∏
          tgtCode,
          cardLabel,             // <‚Äî –Ω–æ–≤–µ
          cardCurrencyTxt        // <‚Äî –Ω–æ–≤–µ
        };
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É:', error);
        throw error;
      }
    }


    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É —á–µ—Ä–µ–∑ Monobank API
    async function updateBalance() {
      const btn = document.getElementById('updateBtn');
      
      // –ë–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫—É –æ–¥—Ä–∞–∑—É
      if (isLoading || cooldownTimer || btn.disabled) return;
      
      isLoading = true;
      btn.disabled = true;
      btn.textContent = '‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';

      try {
        const data = await getBalanceAndRate();

        const codeToSym = (c) => ({980:'‚Ç¥',978:'‚Ç¨',840:'$',826:'¬£',985:'z≈Ç'})[c] || '';
        const codeToTxt = (c) => ({980:'UAH',978:'EUR',840:'USD',826:'GBP',985:'PLN'})[c] || c;

        // –û–Ω–æ–≤–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å–∏ –∫–∞—Ä—Ç–æ–∫ (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –≤–∏–∫–ª–∏–∫)
        // –ø—ñ–¥–ø–∏—Å (—â–æ–± –±—É–ª–æ –≤–∏–¥–Ω–æ –Ω–∞–ø—Ä—è–º–æ–∫)
        document.querySelector('.balance-card.rate label').textContent =
          `–ö—É—Ä—Å –≥—Ä–Ω/${codeToTxt(data.tgtCode)}`;
        document.querySelector('.balance-card.eur label').textContent = `${codeToTxt(data.tgtCode)} (${codeToTxt(data.tgtCode)})`;

        // –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è
        document.getElementById('balanceUAH').textContent = `${data.balanceUAH.toFixed(2)} ‚Ç¥`;
        // –∑–Ω–∞—á–µ–Ω–Ω—è –∫—É—Ä—Å—É ‚Äî —Å–∞–º–µ UAH –∑–∞ 1 tgt
        document.getElementById('rateEUR').textContent =
          data.rateUAHperTgt ? data.rateUAHperTgt.toFixed(4) : '‚Äî';
        document.getElementById('balanceEUR').textContent =
          `${data.balanceTgt.toFixed(2)} ${codeToSym(data.tgtCode) || codeToTxt(data.tgtCode)}`;

        // –Ü—Å—Ç–æ—Ä—ñ—è
        const record = {
          date: formatDate(new Date()),
          card: data.cardLabel,                 // <‚Äî –Ω–æ–≤–µ
          cardCurrency: data.cardCurrencyTxt,   // <‚Äî –Ω–æ–≤–µ
          uah: data.balanceUAH,
          rate: data.rateUAHperTgt || 0,   // <-- –±—É–ª–æ data.convRate
          eur: data.balanceTgt,                 // –ø–æ–ª–µ –≤–∂–µ —î ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —è–∫ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
          currency: codeToTxt(data.tgtCode)     // —â–æ–± —É —ñ—Å—Ç–æ—Ä—ñ—ó –ø–æ–∫–∞–∑—É–≤–∞–ª–∞—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –Ω–∞–∑–≤–∞
        };
        history.unshift(record);
        saveHistory();
        renderHistory();


        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —á–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
        localStorage.setItem('lastUpdateTime', Date.now().toString());

        btn.textContent = '‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ';
        setTimeout(() => {
          startCooldown(90); // –ó–∞–ø—É—Å–∫–∞—î–º–æ 90-—Å–µ–∫—É–Ω–¥–Ω–∏–π —Ç–∞–π–º–µ—Ä
        }, 2000);
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:', error);
        btn.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞';
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Ü–µ –ø–æ–º–∏–ª–∫–∞ rate limit (429)
        if (error.message.includes('429')) {
          alert('–ó–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –∑–∞–ø–∏—Ç—ñ–≤. Monobank –¥–æ–∑–≤–æ–ª—è—î –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ –Ω–µ —á–∞—Å—Ç—ñ—à–µ –Ω—ñ–∂ —Ä–∞–∑ –Ω–∞ 60 —Å–µ–∫—É–Ω–¥.\n\n–ó–∞—á–µ–∫–∞–π—Ç–µ —Ö–≤–∏–ª–∏–Ω—É —ñ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É.');
          startCooldown(90);
        } else {
          // alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ –±–∞–ª–∞–Ω—Å. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω —É config.js\n\n' + error.message);
          alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ –±–∞–ª–∞–Ω—Å. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω —É –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö.\n\n' + error.message);

          setTimeout(() => {
            btn.textContent = 'üîÑ –û–Ω–æ–≤–∏—Ç–∏ –±–∞–ª–∞–Ω—Å';
            btn.disabled = false;
          }, 2000);
        }
      } finally {
        isLoading = false;
      }
    }

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
    function renderHistory() {
      const listEl = document.getElementById('historyList');
      
      if (history.length === 0) {
        listEl.innerHTML = `
          <div class="empty-history">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
              <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
            </svg>
            <p>–Ü—Å—Ç–æ—Ä—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ–π –ø–æ—Ä–æ–∂–Ω—è</p>
          </div>
        `;
        return;
      }

      listEl.innerHTML = history.map(record => `
        <div class="history-item">
          <div class="date">
            üìÖ ${record.date}
            ${record.card ? ` ‚Ä¢ üí≥ ${record.card}` : ''}
            ${record.cardCurrency ? ` ‚Ä¢ ${record.cardCurrency}` : ''}
          </div>
          <div class="values">
            <div class="value">
              <span style="color: #6c757d;">UAH</span>
              <strong style="color: #667eea;">${record.uah.toFixed(2)} ‚Ç¥</strong>
            </div>
            <div class="value">
              <span style="color: #6c757d;">–ö—É—Ä—Å</span>
              <strong style="color: #f6ad55;">${record.rate.toFixed(2)}</strong>
            </div>
            <div class="value">
              <span style="color: #6c757d;">${record.currency || 'EUR'}</span>
              <strong style="color: #48bb78;">${record.eur.toFixed(2)}</strong>
            </div>
          </div>
        </div>
      `).join('');
    }

    // –û—á–∏—â–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
    function clearHistory() {
      if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—é —ñ—Å—Ç–æ—Ä—ñ—é?')) {
        history = [];
        saveHistory();
        renderHistory();
      }
    }

    // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
    document.getElementById('updateBtn').addEventListener('click', updateBalance);
    document.getElementById('clearBtn').addEventListener('click', clearHistory);
    document.getElementById('settingsBtn').addEventListener('click', openSettings);
    document.getElementById('closeSettings').addEventListener('click', closeSettings);
    document.getElementById('loadCardsBtn').addEventListener('click', loadCards);
    document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);

    document.getElementById('clearTokenBtn').addEventListener('click', async () => {
      await window.api.clearToken();
      const tokenInput = document.getElementById('tokenInput');
      tokenInput.disabled = false;
      tokenInput.placeholder = '–í–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω';
      document.getElementById('cardsList').innerHTML =
        '<div class="loading-cards"><p>–í–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏"</p></div>';
    });

    // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–µ—é
    document.getElementById('settingsModal').addEventListener('click', (e) => {
      if (e.target.id === 'settingsModal') {
        closeSettings();
      }
    });

    // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
    // function openSettings() {
    //   document.getElementById('settingsModal').classList.add('active');
    //   // if (currentToken) {
    //   //   document.getElementById('tokenInput').value = currentToken;
    //   // }
    // }

    async function openSettings() {
      document.getElementById('settingsModal').classList.add('active');

      const tokenInput = document.getElementById('tokenInput');
      const loadBtn = document.getElementById('loadCardsBtn');

      try {
        const exists = await window.api.hasToken();
        if (exists) {
          tokenInput.value = '';
          tokenInput.placeholder = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢ –∑–±–µ—Ä–µ–∂–µ–Ω–æ';
          tokenInput.disabled = true;               // –≤–≤—ñ–¥ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω
          loadBtn.disabled = false;                 // –∫–∞—Ä—Ç–∏ –º–æ–∂–Ω–∞ –≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –±–µ–∑ –≤–≤–æ–¥—É
          loadBtn.textContent = 'üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏';
        } else {
          tokenInput.placeholder = '–í–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω';
          tokenInput.disabled = false;
        }
      } catch (e) {
        console.error(e);
      }
    }


    // –ó–∞–∫—Ä–∏—Ç—Ç—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
    function closeSettings() {
      document.getElementById('settingsModal').classList.remove('active');
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫ –∑ API
    async function loadCards() {
      const tokenInput = document.getElementById('tokenInput');
      const btn = document.getElementById('loadCardsBtn');
      const cardsList = document.getElementById('cardsList');

      const raw = tokenInput.value.trim();
      const enteredNewToken = raw.length > 0;

      btn.disabled = true;
      btn.textContent = '‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.';
      cardsList.innerHTML = '<div class="loading-cards"><p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫.</p></div>';

      try {
        if (enteredNewToken) {
          await window.api.saveToken(raw);       // –∑–±–µ—Ä–µ–≥–ª–∏ –Ω–æ–≤–∏–π —Ç–æ–∫–µ–Ω —É keychain
          tokenInput.value = '';
          tokenInput.placeholder = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢ –∑–±–µ—Ä–µ–∂–µ–Ω–æ';
          tokenInput.disabled = true;
        }

        // —á–∏—Ç–∞—î–º–æ –∫–∞—Ä—Ç–∫–∏ —á–µ—Ä–µ–∑ main (—Ç–æ–∫–µ–Ω —É keychain)
        const data = await window.api.getClientInfo();
        availableCards = data.accounts;

        renderCards();
        btn.textContent = '‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ';
        setTimeout(() => { btn.textContent = 'üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏'; }, 2000);
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫:', error);
        cardsList.innerHTML = '<div class="loading-cards"><p style="color: #e53e3e;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω.</p></div>';
        btn.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞';
        setTimeout(() => { btn.textContent = 'üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏'; }, 2000);
      } finally {
        btn.disabled = false;
      }
    }

    /*
    async function loadCards() {
      const token = document.getElementById('tokenInput').value.trim();
      if (!token) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω');
        return;
      }

      const btn = document.getElementById('loadCardsBtn');
      const cardsList = document.getElementById('cardsList');
      
      btn.disabled = true;
      btn.textContent = '‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
      cardsList.innerHTML = '<div class="loading-cards"><p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫...</p></div>';

      // try {
      //   const response = await fetch('https://api.monobank.ua/personal/client-info', {
      //     headers: { 'X-Token': token }
      //   });

      //   if (!response.ok) {
      //     throw new Error(`–ü–æ–º–∏–ª–∫–∞ API: ${response.status}`);
      //   }

      //   const data = await response.json();
      //   availableCards = data.accounts;
      //   currentToken = token;

      //   renderCards();
      //   btn.textContent = '‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ';
      //   setTimeout(() => {
      //     btn.textContent = 'üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏';
      //   }, 2000);
      // } catch (error) {
      //   console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫:', error);
      //   cardsList.innerHTML = '<div class="loading-cards"><p style="color: #e53e3e;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω.</p></div>';
      //   btn.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞';
      //   setTimeout(() => {
      //     btn.textContent = 'üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏';
      //   }, 2000);
      // } finally {
      //   btn.disabled = false;
      // }
      try {
        await window.api.saveToken(token);                 // 1) –∑–±–µ—Ä–µ–≥–ª–∏ –≤ keychain
        const data = await window.api.getClientInfo();     // 2) —á–∏—Ç–∞—î–º–æ —á–µ—Ä–µ–∑ main
        availableCards = data.accounts;

        renderCards();
        btn.textContent = '‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ';
        setTimeout(() => { btn.textContent = 'üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏'; }, 2000);
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫:', error);
        cardsList.innerHTML = '<div class="loading-cards"><p style="color: #e53e3e;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω.</p></div>';
        btn.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞';
        setTimeout(() => { btn.textContent = 'üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏'; }, 2000);
      } finally {
        btn.disabled = false;
      }
    
    }
    */

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫–∞—Ä—Ç–æ–∫
    function renderCards() {
      const cardsList = document.getElementById('cardsList');
      
      if (availableCards.length === 0) {
        cardsList.innerHTML = '<div class="loading-cards"><p>–ö–∞—Ä—Ç–∫–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p></div>';
        return;
      }

      const currencyNames = {
        980: 'UAH',
        978: 'EUR',
        840: 'USD',
        826: 'GBP',
        985: 'PLN'
      };

      const typeNames = {
        'black': 'üñ§ –ß–æ—Ä–Ω–∞',
        'white': 'ü§ç –ë—ñ–ª–∞',
        'platinum': 'üíé Platinum',
        'iron': 'üî© Iron',
        'fop': 'üíº –§–û–ü',
        'yellow': 'üíõ –ñ–æ–≤—Ç–∞',
        'eAid': 'üá∫üá¶ —î–ü—ñ–¥—Ç—Ä–∏–º–∫–∞'
      };

      cardsList.innerHTML = availableCards.map((card, index) => {
        const isSelected = card.id === selectedCardId;
        const balance = (card.balance / 100).toFixed(2);
        const currency = currencyNames[card.currencyCode] || card.currencyCode;
        const typeName = typeNames[card.type] || card.type;
        const maskedPan = card.maskedPan ? card.maskedPan[0] : '';
        const last4 = maskedPan ? maskedPan.slice(-4) : '';

        return `
          <div class="card-option ${isSelected ? 'selected' : ''}" data-card-id="${card.id}">
            <div class="card-info">
              <div class="card-type">${typeName} ${last4 ? `****${last4}` : ''}</div>
              <div class="card-details">${currency} ‚Ä¢ ${card.iban ? card.iban.slice(-8) : 'ID: ' + card.id}</div>
            </div>
            <div class="card-balance">${balance} ${currency === 'UAH' ? '‚Ç¥' : currency}</div>
          </div>
        `;
      }).join('');

      // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –∫–ª—ñ–∫—ñ–≤
      document.querySelectorAll('.card-option').forEach(el => {
        el.addEventListener('click', () => {
          document.querySelectorAll('.card-option').forEach(opt => opt.classList.remove('selected'));
          el.classList.add('selected');
          selectedCardId = el.dataset.cardId;
        });
      });
    }

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
    function saveSettings() {
      if (!availableCards.length) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∫–∞—Ä—Ç–∫–∏');
        return;
      }

      // if (!currentToken) {
      //   alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∫–∞—Ä—Ç–∫–∏');
      //   return;
      // }

      if (!selectedCardId) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –∫–∞—Ä—Ç–∫—É');
        return;
      }

      const settings = {
        // token: currentToken,
        cardId: selectedCardId,
        currency: document.getElementById('currencySelect').value
      };

      localStorage.setItem('appSettings', JSON.stringify(settings));
      closeSettings();
      alert('‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –¢–µ–ø–µ—Ä –º–æ–∂–µ—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ –±–∞–ª–∞–Ω—Å.');
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    loadSettings();
    loadHistory();
  </script>
</body>
</html>